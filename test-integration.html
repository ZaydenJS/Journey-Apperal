<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Integration Status - Journey Apparel</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .status-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin: 16px 0;
        background: #f9f9f9;
      }
      .status-working {
        border-color: #4caf50;
        background: #e8f5e9;
      }
      .status-limited {
        border-color: #ff9800;
        background: #fff3e0;
      }
      .status-error {
        border-color: #f44336;
        background: #ffebee;
      }
      .status-icon {
        font-size: 24px;
        margin-right: 8px;
      }
      h1 {
        color: #333;
      }
      h2 {
        color: #555;
        margin-top: 0;
      }
      .test-btn {
        background: #111;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin: 4px;
      }
      .test-btn:hover {
        background: #333;
      }
      .result {
        margin: 8px 0;
        padding: 8px;
        border-radius: 4px;
      }
      .success {
        background: #e8f5e9;
        color: #2e7d32;
      }
      .warning {
        background: #fff3e0;
        color: #f57c00;
      }
      .error {
        background: #ffebee;
        color: #d32f2f;
      }
    </style>
  </head>
  <body>
    <h1>üöÄ Journey Apparel - Integration Status</h1>

    <div id="environment-status" class="status-card">
      <h2><span class="status-icon">üåç</span>Environment Detection</h2>
      <div id="env-details">Checking...</div>
    </div>

    <div id="api-status" class="status-card">
      <h2><span class="status-icon">üîå</span>Shopify API Status</h2>
      <div id="api-details">Checking...</div>
      <button class="test-btn" onclick="testShopifyAPI()">
        Test API Connection
      </button>
    </div>

    <div id="features-status" class="status-card">
      <h2><span class="status-icon">‚öôÔ∏è</span>Feature Status</h2>
      <div id="features-details">Checking...</div>
    </div>

    <div id="recommendations" class="status-card">
      <h2><span class="status-icon">üí°</span>Recommendations</h2>
      <div id="recommendations-details">Analyzing...</div>
    </div>

    <script src="data/products.js"></script>
    <script src="assets/account.js"></script>

    <script>
      function updateStatus(elementId, status, message) {
        const element = document.getElementById(elementId);
        element.className = `status-card status-${status}`;
        element.querySelector("div:last-child").innerHTML = message;
      }

      function checkEnvironment() {
        const isLocal =
          location.hostname === "localhost" ||
          location.hostname === "127.0.0.1" ||
          location.protocol === "file:";

        const isNetlify =
          location.hostname.includes("netlify.app") ||
          location.hostname.includes("netlify.com");

        let status, message;

        if (isLocal) {
          status = "limited";
          message = `
                    <div class="warning">‚ö†Ô∏è Local Development Environment</div>
                    <p><strong>Current URL:</strong> ${location.href}</p>
                    <p><strong>Limitations:</strong> Shopify API calls will not work locally</p>
                    <p><strong>Recommendation:</strong> Deploy to Netlify for full functionality</p>
                `;
        } else if (isNetlify) {
          status = "working";
          message = `
                    <div class="success">‚úÖ Netlify Deployment Detected</div>
                    <p><strong>Current URL:</strong> ${location.href}</p>
                    <p><strong>Status:</strong> All features should work properly</p>
                `;
        } else {
          status = "working";
          message = `
                    <div class="success">‚úÖ Production Environment</div>
                    <p><strong>Current URL:</strong> ${location.href}</p>
                    <p><strong>Status:</strong> Deployed environment detected</p>
                `;
        }

        updateStatus("environment-status", status, message);
        return { isLocal, isNetlify, status };
      }

      async function checkAPIs() {
        const apis = {
          shopifyAPI: !!window.shopifyAPI,
          cartManager: !!window.cartManager,
          JourneyAuth: !!window.JourneyAuth,
        };

        let status, message;
        const loadedCount = Object.values(apis).filter(Boolean).length;

        if (loadedCount === 3) {
          status = "working";
          message = `
                    <div class="success">‚úÖ All APIs Loaded Successfully</div>
                    <ul>
                        <li>Shopify API Client: ‚úÖ Loaded</li>
                        <li>Cart Manager: ‚úÖ Loaded</li>
                        <li>Authentication: ‚úÖ Loaded</li>
                    </ul>
                `;
        } else {
          status = "error";
          message = `
                    <div class="error">‚ùå Some APIs Failed to Load</div>
                    <ul>
                        <li>Shopify API Client: ${
                          apis.shopifyAPI ? "‚úÖ" : "‚ùå"
                        } ${apis.shopifyAPI ? "Loaded" : "Failed"}</li>
                        <li>Cart Manager: ${apis.cartManager ? "‚úÖ" : "‚ùå"} ${
            apis.cartManager ? "Loaded" : "Failed"
          }</li>
                        <li>Authentication: ${apis.JourneyAuth ? "‚úÖ" : "‚ùå"} ${
            apis.JourneyAuth ? "Loaded" : "Failed"
          }</li>
                    </ul>
                `;
        }

        updateStatus("api-status", status, message);
        return apis;
      }

      async function testShopifyAPI() {
        const resultDiv = document.createElement("div");
        resultDiv.className = "result";

        try {
          if (!window.shopifyAPI) {
            throw new Error("Shopify API not loaded");
          }

          const collections = await window.shopifyAPI.getCollections();

          if (collections.error && collections.fallback) {
            resultDiv.className += " warning";
            resultDiv.innerHTML =
              "‚ö†Ô∏è API test returned fallback response (expected in local development)";
          } else {
            resultDiv.className += " success";
            resultDiv.innerHTML = `‚úÖ API test successful! Found ${
              collections.collections?.length || 0
            } collections`;
          }
        } catch (error) {
          resultDiv.className += " error";
          resultDiv.innerHTML = `‚ùå API test failed: ${error.message}`;
        }

        const apiDetails = document.getElementById("api-details");
        apiDetails.appendChild(resultDiv);
      }

      function checkFeatures(envInfo, apis) {
        const features = [];

        // Product Loading
        if (apis.shopifyAPI && !envInfo.isLocal) {
          features.push("‚úÖ Product Loading: Fully functional");
        } else if (apis.shopifyAPI && envInfo.isLocal) {
          features.push("‚ö†Ô∏è Product Loading: Limited (fallback mode)");
        } else {
          features.push("‚ùå Product Loading: Not available");
        }

        // Cart Functionality
        if (apis.cartManager && !envInfo.isLocal) {
          features.push("‚úÖ Shopping Cart: Fully functional");
        } else if (apis.cartManager && envInfo.isLocal) {
          features.push("‚ö†Ô∏è Shopping Cart: Limited (local mode)");
        } else {
          features.push("‚ùå Shopping Cart: Not available");
        }

        // Customer Accounts
        if (apis.JourneyAuth && !envInfo.isLocal) {
          features.push("‚úÖ Customer Accounts: Fully functional");
        } else if (apis.JourneyAuth && envInfo.isLocal) {
          features.push("‚ö†Ô∏è Customer Accounts: Limited (local mode)");
        } else {
          features.push("‚ùå Customer Accounts: Not available");
        }

        // Basic Website
        features.push("‚úÖ Basic Website: Fully functional");

        const status = features.some((f) => f.includes("‚ùå"))
          ? "error"
          : features.some((f) => f.includes("‚ö†Ô∏è"))
          ? "limited"
          : "working";

        const message = `<ul><li>${features.join("</li><li>")}</li></ul>`;

        updateStatus("features-status", status, message);
        return { features, status };
      }

      function showRecommendations(envInfo, apis, features) {
        let recommendations = [];

        if (envInfo.isLocal) {
          recommendations.push(
            "üöÄ <strong>Deploy to Netlify</strong> for full Shopify functionality"
          );
          recommendations.push(
            "üîß Set environment variables: SHOPIFY_STORE_DOMAIN and SHOPIFY_STOREFRONT_TOKEN"
          );
          recommendations.push(
            "üìù Use the deployment guide in DEPLOYMENT-GUIDE.md"
          );
        }

        if (!apis.shopifyAPI) {
          recommendations.push(
            "üîÑ Check that data/products.js is loading correctly"
          );
        }

        if (
          !(
            window.CartPermalink &&
            typeof window.CartPermalink.buildCartPermalink === "function"
          )
        ) {
          recommendations.push(
            "üõí Ensure CartPermalink (src/lib/cartPermalink.js) is loaded for checkout links"
          );
        }

        if (!apis.JourneyAuth) {
          recommendations.push(
            "üë§ Check that assets/account.js is loading correctly"
          );
        }

        if (recommendations.length === 0) {
          recommendations.push(
            "üéâ Everything looks good! Your integration is working properly."
          );
        }

        const status =
          recommendations.length === 1 && recommendations[0].includes("üéâ")
            ? "working"
            : "limited";
        const message = `<ul><li>${recommendations.join(
          "</li><li>"
        )}</li></ul>`;

        updateStatus("recommendations", status, message);
      }

      // Run all checks on page load
      document.addEventListener("DOMContentLoaded", async () => {
        console.log("üîç Running integration status checks...");

        // Wait a moment for scripts to load
        setTimeout(async () => {
          const envInfo = checkEnvironment();
          const apis = await checkAPIs();
          const features = checkFeatures(envInfo, apis);
          showRecommendations(envInfo, apis, features);

          console.log("‚úÖ Integration status check complete");
        }, 500);
      });
    </script>
  </body>
</html>
