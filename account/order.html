<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Order Details ‚Äî Journeys Apparel</title>
    <meta
      name="description"
      content="View your Journey Apparel order details."
    />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body style="margin: 0; overflow-x: hidden; background: #fff; color: #111">
    <header class="header" style="top: 0; left: 0; right: 0">
      <div
        class="container header-inner"
        style="
          max-width: none;
          width: 100%;
          padding-left: 0;
          padding-right: 16px;
        "
      >
        <div class="nav-left row">
          <button
            class="menu-toggle"
            aria-label="Open menu"
            style="
              background: transparent;
              border: none;
              padding: 8px;
              display: inline-flex;
              flex-direction: column;
              gap: 4px;
              align-items: center;
              justify-content: center;
              width: 36px;
              height: 36px;
              border-radius: 0;
              box-shadow: none;
            "
          >
            <span
              style="
                display: block;
                width: 22px;
                height: 2px;
                background: #000;
                border-radius: 1px;
              "
            ></span>
            <span
              style="
                display: block;
                width: 22px;
                height: 2px;
                background: #000;
                border-radius: 1px;
              "
            ></span>
            <span
              style="
                display: block;
                width: 22px;
                height: 2px;
                background: #000;
                border-radius: 1px;
              "
            ></span>
          </button>
          <nav class="nav" aria-label="Primary">
            <a
              href="/collection.html?collection=best-sellers"
              class="header-item"
              >Best Sellers</a
            >
            <a href="/collection.html?section=new-arrivals" class="header-item"
              >New Arrivals</a
            >
          </nav>
        </div>
        <h1 class="logo">
          <a
            href="/index.html"
            aria-label="Journeys Apparel Home"
            style="font-size: 0.94em; letter-spacing: 1.8px"
            >JOURNEYS</a
          >
        </h1>
        <div class="nav-right">
          <a
            id="headerProfileLink"
            class="icon-btn"
            aria-label="Account"
            href="#"
            style="order: 1"
            >üë§</a
          >
          <button class="icon-btn" aria-label="Search" style="order: 2">
            üîç
          </button>
          <a class="icon-btn" aria-label="Cart" href="#" style="order: 3">üõí</a>
        </div>
      </div>
    </header>

    <main
      class="container section"
      style="max-width: 960px; margin: 0 auto; padding: 24px 16px 64px 16px"
    >
      <a
        href="/account/orders.html"
        style="
          display: inline-block;
          margin-bottom: 12px;
          color: #111;
          text-decoration: none;
        "
        >‚Üê Back to Orders</a
      >
      <section
        aria-label="Order Details"
        style="
          margin: 0 auto;
          border: 1px solid #e5e5e5;
          border-radius: 12px;
          box-shadow: 0 12px 30px rgba(0, 0, 0, 0.06);
          padding: 24px;
          max-width: 720px;
          width: 100%;
        "
      >
        <h1
          class="upper"
          style="
            margin: 0 0 8px 0;
            font-size: 26px;
            font-weight: 900;
            letter-spacing: 0.5px;
          "
        >
          Order
        </h1>
        <p
          id="order-meta"
          style="margin: 0 0 16px 0; color: #666; font-size: 14px"
        >
          Loading...
        </p>
        <div
          id="order-lines"
          role="list"
          aria-label="Line items"
          style="display: flex; flex-direction: column; gap: 8px"
        ></div>
      </section>
    </main>

    <footer style="background: #fff; color: #111; margin-top: 0">
      <div style="border-top: 1px solid #333; padding: 24px 0">
        <div style="max-width: 1200px; margin: 0 auto; padding: 0 16px">
          <div
            style="
              display: flex;
              flex-direction: column;
              align-items: center;
              gap: 16px;
              text-align: center;
            "
          >
            <div
              style="
                display: flex;
                flex-wrap: wrap;
                align-items: center;
                justify-content: center;
                gap: 24px;
              "
            >
              <span style="color: #000; font-size: 14px"
                >¬© 2025 Journey Apparel. All rights reserved. Prices in
                AUD.</span
              >
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script src="/assets/account.js" defer></script>
    <script>
      (function () {
        async function run() {
          await JAAccount.guardAuthenticated();
          var params = new URLSearchParams(location.search);
          var id = params.get("id");
          var meta = document.getElementById("order-meta");
          var list = document.getElementById("order-lines");
          if (!id) {
            if (meta) meta.textContent = "No order specified.";
            return;
          }
          try {
            if (meta) meta.textContent = "Loading order‚Ä¶";
            var res = await fetch(
              "/.netlify/functions/customerOrder?id=" + encodeURIComponent(id),
              { credentials: "include" }
            );
            var text = await res.text();
            var data = text ? JSON.parse(text) : {};
            if (!res.ok)
              throw new Error(
                (data && (data.error || data.message)) || "HTTP " + res.status
              );
            var order = data && data.order;
            if (!order) {
              if (meta) meta.textContent = "Order not found.";
              return;
            }
            var dateText = (order.processedAt || "").slice(0, 10);
            var total = order.totalPriceSet && order.totalPriceSet.shopMoney;
            var totalText = total
              ? total.currencyCode + " " + total.amount
              : "";
            var statusText =
              order.fulfillmentStatus || order.financialStatus || "";
            if (meta)
              meta.textContent =
                (order.name || "Order #" + order.orderNumber) +
                " ‚Ä¢ " +
                dateText +
                " ‚Ä¢ " +
                totalText +
                " ‚Ä¢ " +
                statusText;

            // Render line items
            var items = (order.lineItems && order.lineItems.edges) || [];
            items.forEach(function (edge) {
              var li = edge.node || {};
              var price = li.originalTotalPrice || null;
              var priceText = price
                ? price.currencyCode + " " + price.amount
                : "";
              var row = document.createElement("div");
              row.setAttribute("role", "listitem");
              row.style.cssText =
                "border:1px solid #e5e5e5;border-radius:8px;padding:12px;display:flex;align-items:center;justify-content:space-between;gap:8px";
              row.innerHTML =
                '<div style="color:#111">' +
                (li.title || "Item") +
                "</div>" +
                '<div style="color:#666">Qty ' +
                (li.quantity || 1) +
                "</div>" +
                '<div style="color:#111">' +
                priceText +
                "</div>";
              list.appendChild(row);
            });

            // Addresses & summary
            var summary = document.createElement("div");
            summary.style.cssText =
              "margin-top:12px;color:#444;font-size:14px;display:grid;gap:6px";
            var ship = order.shippingAddress || {};
            var bill = order.billingAddress || {};
            var shipLine = [
              ship.firstName,
              ship.lastName,
              ship.address1,
              ship.address2,
              ship.city,
              ship.province,
              ship.zip,
              ship.country,
            ]
              .filter(Boolean)
              .join(", ");
            var billLine = [
              bill.firstName,
              bill.lastName,
              bill.address1,
              bill.address2,
              bill.city,
              bill.province,
              bill.zip,
              bill.country,
            ]
              .filter(Boolean)
              .join(", ");
            var shippingLine =
              order.shippingLines && order.shippingLines.length
                ? order.shippingLines[0].title || ""
                : "";
            summary.innerHTML =
              "<div><strong>Shipping:</strong> " +
              (shipLine || "‚Äî") +
              "</div>" +
              "<div><strong>Billing:</strong> " +
              (billLine || "‚Äî") +
              "</div>" +
              "<div><strong>Shipping method:</strong> " +
              (shippingLine || "‚Äî") +
              "</div>";
            list.parentNode.appendChild(summary);

            // Fulfillments
            var fulf = order.fulfillments || [];
            if (fulf.length) {
              var fwrap = document.createElement("div");
              fwrap.style.cssText = "margin-top:8px";
              fwrap.innerHTML =
                '<div style="font-weight:700">Fulfillment</div>';
              fulf.forEach(function (f) {
                var t =
                  f.trackingInfo && f.trackingInfo.length
                    ? f.trackingInfo[0]
                    : null;
                var link =
                  t && t.url
                    ? ' <a href="' +
                      t.url +
                      '" target="_blank" rel="noopener" style="color:#111">Track</a>'
                    : "";
                var p = document.createElement("div");
                p.style.cssText = "color:#444;font-size:14px";
                p.innerHTML = (f.status || "Status") + link;
                fwrap.appendChild(p);
              });
              list.parentNode.appendChild(fwrap);
            }
          } catch (e) {
            if (meta)
              meta.textContent =
                e && e.message ? e.message : "Failed to load order.";
          }
        }
        document.addEventListener("DOMContentLoaded", run);
      })();
    </script>
    <script src="/script.js" defer></script>
  </body>
</html>
